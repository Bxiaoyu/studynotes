# 数据提取

> 知识点：
> * 了解响应内容的分类
> * 了解xml和html的区别

## 响应内容的分类

> 在发送请求获取响应之后， 可能存在多种不同类型的响应内容；而且很多时候我们只需要响应内容中的一部分数据

* 结构化的响应内容
  * json字符串
    * 可以使用 re, json等模块来提取特定数据
  * XML字符串
    * 可以使用 re, lxml等模块来提取特定数据

* 非结构化的响应内容
  * html字符串
    * 可以使用 re, lxml等模块来提取特特定数据

* XML和HTML的区别：
  * XML传输和存储数据
  * HTML展示数据 

### 常用数据解析方法

如此图所示：
![parsedata](/image/parsedata_methods.PNG)

### 数据提取-jsonpath模块

***

#### 1.jsonpath模块的使用场景

> 如果一个多层嵌套的复杂字典，想要根据key和下标来提取value，这是比较困难的。jsonpath模块就能解决这个痛点。
**jsonpath可以按照key对python字典进行批量数据提取**

***

#### 2.jsonpath模块的使用方法

##### 2.1 jsonpath模块安装

> jsonpath是第三方模块，需要额外安装

```txt
pip install jsonpath
```

##### 2.2 jsonpath提取数据的方法

```python
from jsonpath import jsonpath

ret = jsonpath('要解析字典数据', 'jsonpath语法规则字符串')
```

##### 2.3 jsonpath语法规则

|jsonpath|描述|
|:-:|:-|
|$|根结点（**常用**）|
|@|现行结点|
|**.** or []|取子节点（**常用**）|
|n/a|取父节点，jsonpath未支持|
|**..**|就是不管位置，选择所有符合条件的条件（**常用**）|
|*|匹配所有元素结点|
|n/a|根据属性访问，json不支持|
|[ ]|迭代器标识，可以做些简单的迭代操作|
|[, ]|支持迭代器中多选|
|?( )|支持过滤操作|
|( )|表达式计算|
|n/a|分组，jsonpath不支持|

**最常用的语法：** $, **.**, **..** 这三个

* 例子：

```python
from jsonpath import jsonpath

data = {'key1':{'key2':{'key3':{'key4':{'key5':{'key6':'hello'}}}}}}

# 使用 . 来逐层访问，返回的结果是列表形式
print(jsonpath(data, '$.key1.key2.key3.key4.key5.key6')[0])

# 使用 .. 来直接访问到目标结点
print(jsonpath(data, '$..key6')[0])

# 结果：返回hello
```

**提示：** json和jsonpath可以配合使用

### 数据提取-lxml模块

#### 1. 了解lxml模块和xpath模块

> 对与html或xml形式的文本提取特定内容，需要用到lxml模块和xpath语法

* lxml模块可以利用xpath语法，来快速定位HTML/XML文档中特定元素以及获取结点信息（文本内容，属性值）
* xpath是一门在HTML/XML文档中查找信息的语言，可用来在HTML/XML文档中对元素和属性进行遍历（w3school官方文档：[http://www.w3school.com.cn/xpath/index.asp](http://www.w3school.com.cn/xpath/index.asp)）
* 提取xml，html中的数据需要lxml模块和xpath语法配合使用

#### 2.Chrome安装xpath helper插件

> xpathhelper插件作用：对当前页面测试xpath语法规则

#### 3. xpath的节点关系

xpath的结点其实是就是HTML标签或是XML标签

#### 4. xpath语法-选取节点以及提取属性或文本内容的语法

> 1. XPath使用路径表达式来选取XML文档中的节点或节点集
> 2. 这些路径表达式和我们在常规的电脑文件系统中的表达式非常相似
> 3. 使用chrome插件选择标签的时候，选中时，选中的标签会添加属性class="xh-highlight"

##### 4.1 xpath定位节点以及提取属性或文本内容的语法